(()=>{"use strict";async function e(e){console.log("handleAABalanceCheck fired...");let s=e.find("#place_order"),a=(e.find("#request_network_wallet_selection_type"),e.find("#abstract-account-payment-usdc-container")),o=a.find(".error-message"),n=a.find(".warning-message"),t=a.find(".error-message-container"),r=a.find(".abstract-account-usdc-spinner");console.log("here is spinner",r),n.addClass("no-show"),o.addClass("no-show"),t.addClass("no-show"),s.addClass("disabled"),s.prop("disabled",!0);let l=e.find("#abstract-account-usdc-balance"),d=l.attr("data-balance");var c=$(".order-total .woocommerce-Price-amount bdi");c.find("*").remove();let i=c.text(),u=parseFloat(i);if(console.log("here is balance in handleAABalanceCheck",d),null!=d&&""!==d){if(console.log("inside balance already exists"),d<=u)return s.addClass("disabled"),s.prop("disabled",!0),n.removeClass("no-show"),void t.removeClass("no-show");if(d>u)return s.removeClass("disabled"),void s.prop("disabled",!1)}console.log("made it to spinner show"),r.addClass("show");try{let e=await async function(e){console.log("getRealTokenWalletBalance fired...");let s={result:"error",message:"Unknown error",balance:0},a=e.attr("data-address");console.log("abstractAccountAddress: ",a);const o=`https://api.gnosisscan.io/api?module=account&action=tokenbalance&contractaddress=0xddafbb505ad214d7b80b1f830fccc89b60fb7a83&address=${a}&tag=latest&apikey=CZWHWE4NNIE41DHI1G5IQS76ZYIKFVZV8A`;try{const e=await fetch(o);if(!e.ok)throw new Error("Error Connecting to gnosisscan for block information");const a=await e.json();if(console.log("here is json_gnosisscan_res",a),!a||"1"!==a.status)return s.message=a?a.message:"Error Connecting to gnosisscan for block information",s;let n=a.result;return n/=Math.pow(10,6),n=n.toFixed(2),s.balance=n,s.result="success",s}catch(e){return s.message=e.message,s}}(a);if(console.log("here is newBalanceRes",e),r.removeClass("show"),"success"!==e.result)throw new Error(e.message);let o=e.balance;console.log("here is newBalance",o),l.attr("data-balance",o);let d=parseFloat(o).toFixed(2).toLocaleString("en-US");if(l.html(`$${d}`),o<=u)return s.addClass("disabled"),s.prop("disabled",!0),n.removeClass("no-show"),void t.removeClass("no-show");if(o>u)return s.removeClass("disabled"),void s.prop("disabled",!1);throw new Error("made it to end throw balance throw error")}catch(e){console.log("cating an error man",e),r.removeClass("show"),o.removeClass("no-show"),t.removeClass("no-show")}}let s,a,o={},n=0,t=!1,r=0,l=0;(()=>{const d=jQuery;d(document).ready((function(){const c=d("#order_review");async function i(){d(document.body).on("updated_checkout",(function(){if(void 0===s){let e=d("#walletless-payment-usdc-container");s=e.length>0}0===l?p():m(n,"error"===n.result,o)}))}function u(e){const o=e.find("#request_network-chain"),n=e.find("#request_network-currency"),t=n.find("option"),r=e.find(".payment_method_request_network .info-box"),l=e.find("#place_order"),c=e.find("#payment_method_request_network");if(o.val(""),o.attr("data-rn-chain",""),n.val(""),n.attr("data-rn-currency",""),a&&(e.find("#request_network_wallet_selection_type").val(""),e.find("#request_network_wallet_selection_type").attr("data-rn_wallet_selection_type","")),t.addClass("hide"),r.addClass("hide"),c.is(":checked")){if(void 0===s){let e=d("#walletless-payment-usdc-container");s=e.length>0}s||(l.addClass("disabled"),l.prop("disabled",!0))}else l.removeClass("disabled"),l.prop("disabled",!1)}async function w(s,o=!1){let n=s.find("#request_network-chain"),t=s.find("#request_network-currency"),r=s.find("#place_order"),l=s.find("#rn-aa-cannot-pay-input"),d=s.find("#request_network_wallet_selection_type");if(!a||!o||"abstract_account"!==d.attr("data-rn_wallet_selection_type"))return n.val()?.length>0&&t.val()?.length>0&&(0===l.length||l.is(":checked"))?(r.removeClass("disabled"),void r.prop("disabled",!1)):(r.addClass("disabled"),void r.prop("disabled",!0));await e(s)}function h(e){const s=e.find("#request_network-chain"),a=e.find("#request_network-currency"),o=e.find(".request-network-data"),n=e.find(".payment_method_request_network .info-box");e.find("#place_order"),s.on("change blur",(function(){const s=d(this).val();a.val(""),a.attr("data-rn-currency","");const t=a.find("option"),r=t.first();t.not(r).remove();let l=d();o.each((function(){const e=d(this);e.attr("data-chain")===s&&e.attr("data-currencies").split(",").forEach((e=>{const s=e.split("|"),a=s[0],o=s[1];l=l.add(d(`<option value="${a}">${o}</option>`))}))})),r.after(l),n.addClass("hide"),w(e,!1)})),a.on("change blur",(function(){const o=s.attr("data-rn-chain"),t=a.attr("data-rn-currency");"matic"===o&&t.toLowerCase().includes("usdc")?n.removeClass("hide"):n.addClass("hide"),w(e,!1)}))}function f(e){const s=e.find("#request_network_wallet_selection_type");console.log("here is $AAWalletSelect in bindAA",s);const a=e.find("#rn-chain-field-p"),o=e.find("#rn-currency-field-p"),n=e.find("#abstract-account-payment-usdc-container");s.on("change",(function(){let s=d(this).val();d(this).attr("data-rn_wallet_selection_type",s),"abstract_account"===d(this).attr("data-rn_wallet_selection_type")?(n.removeClass("no-show"),a.addClass("no-show"),o.addClass("no-show")):(n.addClass("no-show"),a.removeClass("no-show"),o.removeClass("no-show")),w(e,!0)}))}function m(e,s=!1,a){let o=d("#walletless-payment-usdc-container").find("#walletless-usdc-balance"),t=e.toFixed(2).toLocaleString("en-US");o.html(`$${t}`),o.attr("data-balance",e),function(e=!1,s={message:"There was An Error retrieving your walletless balance."}){let a=d("#payment_method_request_network"),o=d("#order_review").find("#place_order"),t=d("#walletless-payment-usdc-container"),r=t.find(".warning-message"),l=t.find(".error-message-container");const c=t.find(".success"),i=t.find(".error"),u=t.find(".error-message");if(e?(i.addClass("show"),u.html(s.message),u.removeClass("no-show"),l.removeClass("no-show")):(i.removeClass("show"),u.addClass("no-show"),l.addClass("no-show")),a.is(":checked")){var w=d(".order-total .woocommerce-Price-amount bdi");w.find("*").remove();let s=w.text(),a=parseFloat(s);n>=a&&(o.removeClass("disabled"),o.prop("disabled",!1),r.addClass("no-show"),l.addClass("no-show")),n<a&&(e||(r.removeClass("no-show"),l.removeClass("no-show"),c.removeClass("show")),o.addClass("disabled"),o.prop("disabled",!0))}else o.removeClass("disabled"),o.prop("disabled",!1)}(s,a)}async function p(){let e=d("#walletless-payment-usdc-container");if(void 0===s&&(s=e.length>0),l>0||t)return;function a(e){return new Promise((s=>setTimeout(s,e)))}if(t=!0,!s)return void(t=!1);const c=e.find(".walletless-usdc-spinner"),i=e.find(".success"),u=e.find(".error");e.find(".error-message"),c.addClass("show"),i.removeClass("show"),u.removeClass("show");let w="request_network_get_walletless_usdc_balance";try{const{ajax_url:e,request_network_public_nonce:s,wp_user_id:d}=(h="request_network_public_data",window[h]?window[h]:{}),i={action:w,request_network_public_nonce:s,userId:d};r++;const u=await(async(e,s)=>{console.log("fetchWP has ajax_url:",e),console.log("fetchWP has payload:",s);const a=jQuery;try{const o=await fetch(e,{credentials:"same-origin",method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=utf-8"},body:a.param(s)});if(o.ok)return o.json();throw new Error("There was an Ajax error.")}catch(e){return console.error("There was an Ajax error."),e}})(e,i);return"success"===u.result?(l++,o=u,n=u.balance,c.removeClass("show"),m(u.balance,!1,u),void(t=!1)):(c.removeClass("show"),m(0,!0,u),console.log(`${w} response error: ${u.message}`),void(r<3&&(t=!1,await a(3e3),p())))}catch(e){t=!1,m(0,!0,{message:"Your walletless Balance could not be retrieved."}),c.removeClass("show"),console.log(`${w} response error 2!`),r<3&&(await a(3e3),p())}var h}c.length<1||(u(c),h(c),f(c),d(document.body).on("updated_checkout",(function(){if(void 0===s){let e=d("#walletless-payment-usdc-container");s=e.length>0}if(void 0===a){let e=d("#abstract-account-payment-usdc-container");a=e.length>0}s||(u(c),h(c),a&&f(c))})),s&&i(),i())}))})()})();